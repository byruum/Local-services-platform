<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nairobi Locals</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f5f5f5;margin:0}
header{background:#111;color:#fff;padding:15px;text-align:center}
h2,h3{margin-top:0}
.container{padding:15px;max-width:1000px;margin:auto}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:6px}
.hidden{display:none}
input,select,textarea,button{width:100%;padding:8px;margin:6px 0}
button{background:#111;color:#fff;border:none;border-radius:4px}
.provider-card img{width:100%;max-height:200px;object-fit:cover}
.badge{background:red;color:white;padding:2px 6px;font-size:12px;border-radius:3px}
</style>
</head>

<body>

<header>
  <h2>Nairobi Locals</h2>
  <p>Find trusted local service providers in Nairobi</p>
</header>

<div class="container">

<!-- PUBLIC MARKETPLACE -->
<div id="publicView">
  <div class="card">
    <h3>Are you a service provider?</h3>
    <button onclick="showProviderAuth()">Create account / Login</button>
  </div>

  <div class="card">
    <h3>Browse Providers</h3>
    <input id="filterLocation" placeholder="Search by location">
    <button onclick="loadProviders()">Search</button>
  </div>

  <div id="providersList"></div>
</div>

<!-- PROVIDER AUTH -->
<div id="providerAuth" class="hidden card">
  <h3>Provider Login / Register</h3>

  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">

  <button onclick="login()">Login</button>
  <button onclick="showRegister()">Register</button>
  <button onclick="resetPassword()">Forgot password</button>

  <p id="authMsg"></p>
</div>

<!-- PROVIDER REGISTRATION -->
<div id="registerBox" class="hidden card">
  <h3>Create Provider Account</h3>
  <input id="rName" placeholder="Full name">
  <input id="rPhone" placeholder="Phone number">
  <input id="rEmail" placeholder="Email">
  <input id="rPassword" type="password" placeholder="Password">

  <button onclick="register()">Register (Free 24hrs)</button>
</div>

<!-- PROVIDER DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="card">
    <h3>Provider Dashboard</h3>
    <p id="expiryInfo"></p>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="card">
    <h3>Complete Your Listing</h3>

    <input id="pLocation" placeholder="Location (e.g. Westlands)">
    <input id="pSubLocation" placeholder="Sub-location">

    <select id="pServices" multiple>
      <option>Incall</option>
      <option>Outcall</option>
      <option>Dinner Company</option>
      <option>Massage</option>
      <option>GFE</option>
    </select>

    <textarea id="pPrices" placeholder="Prices & Packages"></textarea>
    <input type="file" id="pPhotos" multiple>

    <button onclick="saveProfile()">Save Listing</button>
    <p id="saveMsg"></p>
  </div>

  <div class="card">
    <h3>Upgrade Listing</h3>
    <p>VIP listing adds KES 150 on all packages</p>
    <button onclick="alert('Payment integration later')">Upgrade</button>
  </div>

  <div class="card">
    <h3>Inquiries</h3>
    <div id="inbox"></div>
  </div>

</div>

</div>

<script>
let currentUser=null;

function showProviderAuth(){
  hideAll();
  providerAuth.classList.remove("hidden");
}

function showRegister(){
  providerAuth.classList.add("hidden");
  registerBox.classList.remove("hidden");
}

function register(){
  const user={
    name:rName.value,
    phone:rPhone.value,
    email:rEmail.value,
    password:rPassword.value,
    location:"",
    subLocation:"",
    services:[],
    prices:"",
    photos:[],
    inbox:[],
    freeUntil:Date.now()+86400000,
    vip:false
  };
  localStorage.setItem("prov_"+user.email,JSON.stringify(user));
  currentUser=user;
  openDashboard();
}

function login(){
  const u=localStorage.getItem("prov_"+email.value);
  if(!u){authMsg.innerText="Account not found";return;}
  const user=JSON.parse(u);
  if(user.password!==password.value){
    authMsg.innerText="Wrong password";return;
  }
  currentUser=user;
  openDashboard();
}

function resetPassword(){
  authMsg.innerText="Password reset link would be sent to email (backend required)";
}

function openDashboard(){
  hideAll();
  dashboard.classList.remove("hidden");
  checkExpiry();
  loadInbox();
}

function saveProfile(){
  currentUser.location=pLocation.value;
  currentUser.subLocation=pSubLocation.value;
  currentUser.services=[...pServices.selectedOptions].map(o=>o.value);
  currentUser.prices=pPrices.value;

  const files=pPhotos.files;
  for(let f of files){
    const reader=new FileReader();
    reader.onload=e=>{
      currentUser.photos.push(e.target.result);
      localStorage.setItem("prov_"+currentUser.email,JSON.stringify(currentUser));
    };
    reader.readAsDataURL(f);
  }
  localStorage.setItem("prov_"+currentUser.email,JSON.stringify(currentUser));
  saveMsg.innerText="Listing saved and live!";
}

function loadProviders(){
  providersList.innerHTML="";
  for(let k in localStorage){
    if(k.startsWith("prov_")){
      const p=JSON.parse(localStorage[k]);
      if(filterLocation.value && !p.location.toLowerCase().includes(filterLocation.value.toLowerCase()))continue;

      const div=document.createElement("div");
      div.className="card provider-card";
      div.innerHTML=`
        <h3>${p.name} ${p.vip?'<span class="badge">VIP</span>':''}</h3>
        <p>${p.location} - ${p.subLocation}</p>
        <p>${p.services.join(", ")}</p>
        <p>${p.prices}</p>
        ${p.photos[0]?`<img src="${p.photos[0]}">`:''}
        <textarea placeholder="Send inquiry"></textarea>
        <button onclick="sendInquiry('${p.email}',this)">Send Message</button>
      `;
      providersList.appendChild(div);
    }
  }
}

function sendInquiry(email,btn){
  const msg=btn.previousElementSibling.value;
  if(!msg)return;
  const p=JSON.parse(localStorage.getItem("prov_"+email));
  p.inbox.push({msg, date:new Date().toLocaleString()});
  localStorage.setItem("prov_"+email,JSON.stringify(p));
  alert("Inquiry sent");
}

function loadInbox(){
  inbox.innerHTML="";
  currentUser.inbox.forEach(m=>{
    inbox.innerHTML+=`<p>${m.date}: ${m.msg}</p>`;
  });
}

function checkExpiry(){
  if(Date.now()>currentUser.freeUntil){
    expiryInfo.innerText="Listing expired. Please upgrade.";
  }else{
    const hrs=Math.round((currentUser.freeUntil-Date.now())/3600000);
    expiryInfo.innerText="Free listing active: "+hrs+" hours remaining";
  }
}

function logout(){
  currentUser=null;
  hideAll();
  publicView.classList.remove("hidden");
}

function hideAll(){
  publicView.classList.add("hidden");
  providerAuth.classList.add("hidden");
  registerBox.classList.add("hidden");
  dashboard.classList.add("hidden");
}

loadProviders();
</script>

</body>
</html>
